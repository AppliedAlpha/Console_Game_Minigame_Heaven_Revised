#include "../src/action.h"

void star_n7(int* total1, int* total2, int* dwID) {
	cls();
	int map1[34][19] = {
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0 },
	{ 0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0 },
	{ 0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0 },
	{ 0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,0,0,0 },
	{ 0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,0,1,1,1,0,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } };
	int map2[34][19] = {
		{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0 },
	{ 0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0 },
	{ 0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0 },
	{ 0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,0,0,0 },
	{ 0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,0,1,1,1,0,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0 },
	{ 0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 },
	{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } };
	chrpos p1 = { 9,0 };
	chrpos p2 = { 9,0 };
	int sc1 = 0, sc2 = 0;
	int rd, i, j;
	normalbound(c_gray);
	halfbound(c_gray, 2);
	for (i = 1; i < 18; i++) {
		for (j = 2; j < 25; j++) {
			tc(cc_yellow);
			if (map1[j][i] == 1) {
				gotoxy(2 * i + 2, j + 1);
				printf("бс");
			}
			if (map2[j][i] == 1) {
				gotoxy(2 * i + 40, j + 1);
				printf("бс");
			}
		}
	}
	while (sc1 <= 2 && sc2 <= 2) {
		print_score(sc1, sc2);
		for (i = 1; i < 18; i++) {
			for (j = 2; j < 25; j++) {
				if (map1[j][i]) {
					if (p1.posx != i || p1.posy != j) {
						switch (map1[j][i]) {
						case 1: case 4: tc(cc_yellow); break;
						case 2: tc(cc_green); break;
						case 3: tc(cc_blue); break;
						}
						gotoxy(2 * i + 2, j + 1);
						printf("бс");
					}
				}
				if (map2[j][i]) {
					if (p2.posx != i || p2.posy != j) {
						switch (map2[j][i]) {
						case 1: case 4: tc(cc_yellow); break;
						case 2: tc(cc_green); break;
						case 3: tc(cc_blue); break;
						}
						gotoxy(2 * i + 40, j + 1);
						printf("бс");
					}
				}
			}
		}
		gotoxy(2 * p1.posx + 2, p1.posy + 1);
		tc(cc_cyan);
		printf("в┬");
		gotoxy(2 * p2.posx + 40, p2.posy + 1);
		tc(cc_red);
		printf("в┬");
		Sleep(50);
		if (GetAsyncKeyState(A) && p1.posx > 0) {
			gotoxy(2 * p1.posx + 2, p1.posy + 1);
			printf("  ");
			p1.posx--;
			if (map1[p1.posy][p1.posx] == sc1 + 1) map1[p1.posy][p1.posx]++;
		}
		if (GetAsyncKeyState(D) && p1.posx < 18) {
			gotoxy(2 * p1.posx + 2, p1.posy + 1);
			printf("  ");
			p1.posx++;
			if (map1[p1.posy][p1.posx] == sc1 + 1) map1[p1.posy][p1.posx]++;
		}
		if (GetAsyncKeyState(W) && p1.posy > 0) {
			gotoxy(2 * p1.posx + 2, p1.posy + 1);
			printf("  ");
			p1.posy--;
			if (map1[p1.posy][p1.posx] == sc1 + 1) map1[p1.posy][p1.posx]++;
		}
		if (GetAsyncKeyState(S) && p1.posy < 33) {
			gotoxy(2 * p1.posx + 2, p1.posy + 1);
			printf("  ");
			p1.posy++;
			if (map1[p1.posy][p1.posx] == sc1 + 1) map1[p1.posy][p1.posx]++;
		}
		if (GetAsyncKeyState(J) && p2.posx > 0) {
			gotoxy(2 * p2.posx + 40, p2.posy + 1);
			printf("  ");
			p2.posx--;
			if (map2[p2.posy + 1][p2.posx - 19] == sc2 + 1) map2[p2.posy + 1][p2.posx - 19]++;
		}
		if (GetAsyncKeyState(L) && p2.posx < 18) {
			gotoxy(2 * p2.posx + 40, p2.posy + 1);
			printf("  ");
			p2.posx++;
			if (map2[p2.posy + 1][p2.posx - 19] == sc2 + 1) map2[p2.posy + 1][p2.posx - 19]++;
		}
		if (GetAsyncKeyState(I) && p2.posy > 0) {
			gotoxy(2 * p2.posx + 40, p2.posy + 1);
			printf("  ");
			p2.posy--;
			if (map2[p2.posy + 1][p2.posx - 19] == sc2 + 1) map2[p2.posy + 1][p2.posx - 19]++;
		}
		if (GetAsyncKeyState(K) && p2.posy < 33) {
			gotoxy(2 * p2.posx + 40, p2.posy + 1);
			printf("  ");
			p2.posy++;
			if (map2[p2.posy + 1][p2.posx - 19] == sc2 + 1) map2[p2.posy + 1][p2.posx - 19]++;
		}
		int ct1 = 0, ct2 = 0;
		for (i = 1; i < 18; i++) {
			for (j = 9; j < 25; j++) {
				if (map1[j][i] == sc1 + 2) ct1++;
				if (map2[j][i] == sc2 + 2) ct2++;
			}
		}
		if (ct1 == 63) sc1++;
		if (ct2 == 63) sc2++;
	}
	for (i = 1; i < 18; i++) {
		for (j = 2; j < 25; j++) {
			if (map1[j][i]) {
				switch (map1[j][i]) {
				case 1: case 4: tc(cc_yellow); break;
				case 2: tc(cc_green); break;
				case 3: tc(cc_blue); break;
				}
				gotoxy(2 * i + 2, j + 1);
				printf("бс");
			}
			if (map2[j][i]) {
				switch (map2[j][i]) {
				case 1: case 4: tc(cc_yellow); break;
				case 2: tc(cc_green); break;
				case 3: tc(cc_blue); break;
				}
				gotoxy(2 * i + 40, j + 1);
				printf("бс");
			}
		}
	}
	print_score(sc1, sc2);
	if (sc1 > sc2) {
		tc(cc_cyan);
		p1_win(&total1, &total2, &dwID);
	}
	else if (sc2 > sc1) {
		tc(cc_red);
		p2_win(&total1, &total2, &dwID);
	}
	else {
		tc(cc_green);
		tie(&dwID);
	}
	Sleep(3000);
}